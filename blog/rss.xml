<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>My Site Blog</title>
        <link>https://github.com/Spencer.github.io/blog</link>
        <description>My Site Blog</description>
        <lastBuildDate>Sun, 09 Mar 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Locking NinjaOne Systray scripts from users]]></title>
            <link>https://github.com/Spencer.github.io/blog/AdminLock-Script</link>
            <guid>https://github.com/Spencer.github.io/blog/AdminLock-Script</guid>
            <pubDate>Sun, 09 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[This guide explains how to create scripts for the NinjaOne system tray and configure some to run exclusively for administrators, using a checkbox within NinjaOne to control access. This approach enhances security and oversight for script execution. However, this method is best suited for restricting scripts that you’d prefer end users not interact with, rather than for critical security measures. It’s ideal for minor administrative tasks where accidental access wouldn’t pose a significant security risk, not for safeguarding highly sensitive operations.]]></description>
            <content:encoded><![CDATA[<p>This guide explains how to create scripts for the NinjaOne system tray and configure some to run exclusively for administrators, using a checkbox within NinjaOne to control access. This approach enhances security and oversight for script execution. However, this method is best suited for restricting scripts that you’d prefer end users not interact with, rather than for critical security measures. It’s ideal for minor administrative tasks where accidental access wouldn’t pose a significant security risk, not for safeguarding highly sensitive operations.</p>
<p><strong>Disclaimer</strong>: I am not responsible for any actions you take based on this guide or the outcomes that result from implementing these configurations. Use at your own discretion and ensure they align with your organization’s security policies.</p>
<p><strong>Resources and Credits</strong>:</p>
<ul>
<li>All icons and fonts referenced in this guide can be found at <a href="https://fonts.google.com/icons?icon.size=24&amp;icon.color=%23e3e3e3" target="_blank" rel="noopener noreferrer">Google Fonts - Symbols &amp; Icons</a>.</li>
<li>Special thanks to the <a href="https://www.youtube.com/watch?v=qBhk0awc3-c" target="_blank" rel="noopener noreferrer">NinjaOne Stream</a> for inspiration and insights.</li>
<li>Shoutout to JT (MrDrProfessorJT) and Trevor (StrikerTS) for sharing that resource, and to Joseph for the inspiration!</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-access-global-custom-fields">Step 1: Access Global Custom Fields<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#step-1-access-global-custom-fields" class="hash-link" aria-label="Direct link to Step 1: Access Global Custom Fields" title="Direct link to Step 1: Access Global Custom Fields">​</a></h2>
<p>Navigate to <strong>Settings &gt; Administration &gt; Global Custom Fields</strong> in the NinjaOne interface to begin setting up the necessary configurations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-define-a-new-global-custom-field">Step 2: Define a New Global Custom Field<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#step-2-define-a-new-global-custom-field" class="hash-link" aria-label="Direct link to Step 2: Define a New Global Custom Field" title="Direct link to Step 2: Define a New Global Custom Field">​</a></h2>
<p>Set up a global custom field with the following details to track admin status:</p>
<table><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody><tr><td>Custom Field Type</td><td>Check box</td></tr><tr><td>Label</td><td>AdminStatus</td></tr><tr><td>Definition Scope</td><td>Device</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configure-permissions">Configure Permissions<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#configure-permissions" class="hash-link" aria-label="Direct link to Configure Permissions" title="Direct link to Configure Permissions">​</a></h3>
<p>Assign the appropriate permissions to control access to this field:</p>
<table><thead><tr><th>Role</th><th>Permission</th></tr></thead><tbody><tr><td>Technician</td><td>Editable</td></tr><tr><td>Automation</td><td>Read/Write</td></tr><tr><td>API</td><td>None</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="restricting-system-tray-scripts">Restricting System Tray Scripts<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#restricting-system-tray-scripts" class="hash-link" aria-label="Direct link to Restricting System Tray Scripts" title="Direct link to Restricting System Tray Scripts">​</a></h2>
<p>Incorporate the following PowerShell code into any system tray script you want to limit to admin users only:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$AdminStatusFieldName = "AdminStatus"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$MessageTitle = "Access Denied"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$MessageBody = "This script requires administrative privileges. Contact your admin for assistance."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$AdminStatus = Ninja-Property-Get $AdminStatusFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($AdminStatus -ne 1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $Session = Get-CimInstance -ClassName Win32_ComputerSystem | Select-Object -ExpandProperty UserName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if ($Session) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $Username = $Session.Split('\')[1]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Invoke-Expression "msg $($Username) /TIME:30 '$MessageTitle - $MessageBody'"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Write-Output "Message sent to $($Username): Admin access required."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Write-Output "No active user session detected to notify."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ## Insert Script to run here!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Output "Admin access granted. Running admin script."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="safeguarding-the-admin-restriction">Safeguarding the Admin Restriction<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#safeguarding-the-admin-restriction" class="hash-link" aria-label="Direct link to Safeguarding the Admin Restriction" title="Direct link to Safeguarding the Admin Restriction">​</a></h2>
<p>To prevent the <code>AdminStatus</code> field from being left enabled accidentally, set up an automated process to enforce its restricted state.
Depending on your preferences, configure this as an automation policy or a scheduled task.
Execute the following script hourly to automatically disable the field if it’s been overlooked:</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$AdminStatusFieldName = "AdminStatus"</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$AdminStatus = Ninja-Property-Get $AdminStatusFieldName</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if ($AdminStatus -ne 0) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Ninja-Property-Set $AdminStatusFieldName 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Output "AdminStatus has been successfully disabled."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Write-Output "AdminStatus is already in a disabled state."</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-system-tray-for-admin-only-scripts">Configuring the System Tray for Admin-Only Scripts<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#configuring-the-system-tray-for-admin-only-scripts" class="hash-link" aria-label="Direct link to Configuring the System Tray for Admin-Only Scripts" title="Direct link to Configuring the System Tray for Admin-Only Scripts">​</a></h2>
<p>Next, let’s configure the NinjaOne system tray to clearly distinguish and organize scripts reserved for admin use. This setup ensures they’re both easily recognizable and securely managed.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="steps">Steps:<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#steps" class="hash-link" aria-label="Direct link to Steps:" title="Direct link to Steps:">​</a></h3>
<ol>
<li>Go to <strong>Administration &gt; Branding &gt; Systray</strong> in the NinjaOne interface.</li>
<li>Either create a new system tray configuration or edit an existing one.</li>
<li>Add the following elements to structure your admin-only scripts:</li>
</ol>
<table><thead><tr><th>Menu Item Type</th><th>Details</th></tr></thead><tbody><tr><td>Separator</td><td>(Creates a visual break)</td></tr><tr><td>Group</td><td>Label: "Admin Only Scripts"</td></tr><tr><td>Automation</td><td>Your admin-specific scripts</td></tr></tbody></table>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="explanation">Explanation:<a href="https://github.com/Spencer.github.io/blog/AdminLock-Script#explanation" class="hash-link" aria-label="Direct link to Explanation:" title="Direct link to Explanation:">​</a></h3>
<ul>
<li><strong>Separator</strong>: Inserts a dividing line in the tray menu to enhance visual separation.</li>
<li><strong>Group</strong>: Establishes a labeled section titled "Admin Only Scripts" to categorize restricted scripts.</li>
<li><strong>Automation</strong>: Nest your admin-only automations (e.g., scripts with the <code>AdminStatus</code> check) under the "Admin Only Scripts" group. This nesting ensures these scripts appear as submenu items beneath the group label, keeping them organized and clearly tied to their admin-only purpose.</li>
</ul>
<p>This configuration not only isolates admin scripts visually in the system tray but also reinforces their restricted access through the <code>AdminStatus</code> check, providing a seamless experience for technicians.</p>
<p>See below for a visual guide on the systray setup, and the message a user will see if they dont have the permissions to run this.</p>
<img src="https://github.com/user-attachments/assets/6fa5af98-e91d-49a6-b1e8-24e474745bb1" alt="Admin Only Scripts System Tray Example" width="300">
<img src="https://github.com/user-attachments/assets/3e9481d7-bfbc-4106-90d4-dc4b03d5a6c7" alt="Invalid rights message" width="300">]]></content:encoded>
            <category>Powershell</category>
        </item>
    </channel>
</rss>